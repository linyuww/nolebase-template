# 简单的c语言编译器

实现语法检测和编译运行的功能


参考资料：
[手把手教你构建 C 语言编译器](https://lotabout.me/2015/write-a-C-interpreter-0/)
[700行手写编译器](https://www.bilibili.com/video/BV1Kf4y1V783/?spm_id_from=333.337.search-card.all.click)

## Next函数

是一个词法分析器的核心部分，用于从源代码中逐字符读取并识别基本的语言构造，如变量名、数字、字符串、注释以及各种操作符。它通过不断读取源代码中的字符（token），并根据这些字符的值执行不同的逻辑分支，来实现对不同语言元素的识别与标记。以下是函数的主要功能：

（1）  **跳过换行符**：增加行号计数，用于错误报告或调试信息。

（2）  **跳过宏定义**：识别以#开头的宏定义并跳过，因为不支持宏处理。

（3）  **识别标识符和关键字**：通过检查字符是否为字母或下划线，识别出变量名或函数名，并使用哈希散列来查找或添加到符号表中。

（4）  **识别数字**：处理十进制、十六进制和八进制数值。

（5）  **处理字符串和字符常量**：识别由双引号或单引号包围的字符串和字符常量，并处理转义字符。

（6）  **跳过单行注释**：识别以//开头的单行注释并跳过。

（7）  **识别操作符**：处理各种操作符，如赋值(=)、等于（==）、加法（+）、减法（-）、逻辑与（&&）、逻辑或（||）等，并区分一些操作符的不同用法（如+和++）。

（8）  **处理其他特殊字符**：如括号、分号、逗号等，直接跳过。

 

 

 

## stmt函数

语句解析：处理基本的语句类型，如 if 语句、while 循环、return 语句和函数语句（用 {} 包围的代码块）。

（1）     **类型和运算符优先级处理**：根据操作符的优先级和类型（如整型、字符型、指针）进行解析和生成中间代码。

（2）     **错误检测**：在语法分析阶段进行更多的错误检测，如缺少分号、未定义变量、错误的类型转换等

 

## Program函数 

变量解析

（1）     **常量解析**：处理整型常量，字符串常量变量：int，char，int*, char*类型变量

（2）     **全局变量**定义(int，char，int*，char*类型定义)

（3）     **类型定义**(仅支持枚举类型)

函数解析：

（1）     **全局声明解析**

（2）     **函数定义**

（3）     **函数参数解析**，局部变量定义解析，函数体解析，语句解析，局部变量定义解析

错误检测：变量的重定义以及未定义错误，函数的相关错误等

 

## Expr函数

通过递归下降解析方法处理不同类型的表达式，包括算术运算、逻辑运算、条件表达式、函数调用、变量访问、类型转换等，并生成相应的中间代码（IR）。以下是其主要功能概括：

（1）     **错误处理**：检测并报告语法错误或不期望的表达式结束，如未预期的文件结束、缺少括号等。

（2）     **立即数和字符串处理**：处理数字常量和字符串字面量，为它们生成立即数加载指令。

（3）     **sizeof****操作**：解析sizeof运算符，支持对基本类型（如int、char）和指针类型的大小计算，并生成相应的立即数加载指令。

（4）     **函数调用**：解析函数调用表达式，包括参数的处理和函数地址的加载。支持系统调用和用户定义函数的区分。

（5）     **变量访问**：处理全局变量、局部变量和数字常量的访问，生成相应的加载或地址计算指令。

（6）     **类型转换和强制类型转换**：解析类型转换表达式，支持基本类型和指针类型的转换。

（7）     **一元和二元运算符**：解析包括算术运算、逻辑非、位取反、自增自减、取地址和解引用等运算符的表达式，并生成相应的中间代码。

（8）     **条件表达式**：处理条件运算符，支持短路逻辑。

（9）     **赋值操作** (Assign): 检查左值是否合法，然后递归解析右值表达式，并根据结果类型生成赋值指令。

（10）   **条件表达式** (Cond): 解析三元条件表达式，生成条件跳转代码来处理真假分支。

（11）   **逻辑运算** (Lor, Lan): 解析逻辑或和逻辑与表达式，生成相应的跳转代码以实现短路求值。

（12）   **位运算** (Or, Xor, And): 解析位或、位异或、位与表达式，生成对应的位运算指令。

（13）   **比较运算** (Eq, Ne, Lt, Gt, Le, Ge): 解析等于、不等于、小于、大于、小于等于、大于等于比较操作，生成比较和跳转指令。

（14）   **移位运算** (Shl, Shr): 解析左移和右移操作，生成移位指令。

（15）   **算术运算** (Add, Sub, Mul, Div, Mod): 解析加、减、乘、除、取模运算，生成相应的算术指令。特别地，对于加减操作，如果操作数是指针类型，还会进行指针算术运算的处理。

（16）   **自增自减操作** (Inc, Dec): 解析自增和自减操作，检查操作数是否为合法的左值，生成自增或自减指令。

（17）   **数组访问** (Brak): 解析数组访问表达式，生成数组索引计算和访问指令。

 

## Eval函数虚拟机

（1）     **指令执行**：虚拟机通过逐条执行中间代码来模拟程序的运行。支持的指令包括加载和存储、算术运算、逻辑运算、跳转、函数调用和返回等。

（2）     **寄存器和堆栈管理**：维护虚拟机的寄存器（如程序计数器 pc、栈指针 sp、基指针 bp）和堆栈，实现函数调用栈帧的管理。

（3）     **系统调用**：支持基本的系统调用，如打开文件、读取文件、关闭文件、打印输出、动态内存分配等。